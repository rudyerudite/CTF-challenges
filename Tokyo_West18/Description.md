# Revolutional Secure Angou Writeup

In this challenge we are provided with 3 files. The file generator.rb is the encryption script in ruby. We will now analyze this script and see if we can find any odds which may favour us to find our flag!

```ruby
require 'openssl'

e = 65537
while true
  p = OpenSSL::BN.generate_prime(1024, false)
  q = OpenSSL::BN.new(e).mod_inverse(p) 
  next unless q.prime?
  puts(q.prime?)
  key = OpenSSL::PKey::RSA.new
  key.set_key(p.to_i * q.to_i, e, nil)
  File.write('publickey.pem', key.to_pem)
  File.binwrite('flag.encrypted', key.public_encrypt(File.binread('flag')))
  break
end 
```

Let's anyalyze our inferences from the script. The prime generated is a random prime number which is of the size 1024 bits. the prime number q is generated by taking modular inverse of e over p. 

###### * q = e <sub> -1 </sub>  mod p --> 1

We can arrange the above equation like that in the following steps. Here, e is known and p and q are primes.

###### * qe = kp + 1 --> 2
###### * n = p * q   --> 3
###### * p = n / q   --> 4
###### * q <sub> 2 </sub>e - q - k*n = 0 --> 5

We solve the above quadratic equation ( 5 ) and to get the value of q. We will have to bruteforce the value of k and find the value of q as per the above equation. We can check that if we have got the correct q by checking whether gcd of n (= p * q) and q is q.
Once we get the value of q we can find the value phi (n) accordingly and then find the decryption key d and finally decrypt our ciphertext c to get our original message m.

Hope this writeup was helpful to you! Well, this was also the first RSA challege which I could solve during a CTF. ^ _ ^









